パーミッション
====

パーミッションとは
----

* Unix系OSでは、ファイルやディレクトリごとに誰がどんな操作をできるかが設定されています
    * また、変更することができます
    * なお、Windowsにも同様の機能があります
* この誰にどんな操作が許可されているかの設定を、**パーミッション**(permissoion)と言います
    * 許可されていることを「権限がある」という
    * 「アクセス権」とも呼ばれる

パーミッションの確認
----

* `ls -l`で確認できます
* 次のディレクトリの中の場合について確認してみてください
    * `~/kenshu/test1`(研修で作ったディレクトリ)
    * `/bin`(システムで使うプログラムが保存されているディレクトリ)(ここにあるものが何か分かったら鋭い！)
* 最初の`-r-xr-xr-x`などとなっている部分がパーミッションです

```
macmini-ssuzuki:~ ssuzuki$ ls -l ~/kenshu/test1
total 8
-rw-r--r--@ 1 ssuzuki  staff  495  3 22 21:54 renshu1.txt
drwxr-xr-x  2 ssuzuki  staff   68  3 26 20:00 test11
macmini-ssuzuki:~ ssuzuki$ ls -l /bin
total 8416
-r-xr-xr-x  2 root  wheel    43120  6  1  2012 [
-r-xr-xr-x  1 root  wheel  1371648  6  1  2012 bash
-r-xr-xr-x  1 root  wheel    44192  6  1  2012 cat
-r-xr-xr-x  1 root  wheel    62768  6  1  2012 chmod
-r-xr-xr-x  1 root  wheel    57808  6  1  2012 cp
-rwxr-xr-x  2 root  wheel   357984  6  1  2012 csh
-rwxr-xr-x  1 root  wheel    24496  6  1  2012 date
-rwxr-xr-x  1 root  wheel    23872  6  1  2012 dd
-rwxr-xr-x  1 root  wheel    19536  6  1  2012 df
(以下略)
```

誰に対して許可するのか
----

* パーミッションは、**所有するユーザ(owner)**、**グループ**(group)、**その他のユーザ**(other)に対してそれぞれ設定されます
* パーミッションを表す文字(10文字)は、1文字目以外は3文字ずつセットになっており、それぞれ以下の対象に対する権限を表します
    * 2-4文字目 : 所有者(owner)に対する権限
    * 5-7文字目 : グループ(group)に対する権限
    * 8-10文字目 : その他のユーザ(other)に対する権限
* 例えば下記の場合

```
drwxr-xr-x  2 ssuzuki  staff   68  3 26 20:00 test11
```

* 2-4文字目は所有者`ssuzuki`に対する権限
* 5-7文字目はグループ`staff`に対する権限
* 8-10文字目はそのどれにも属さないユーザに対する権限

何を許可するのか
----

* 具体的に許可される権限は、次の3種類に分かれます
    * 読み込み(read)権限 : ファイルの内容を見る、またはディレクトリ中のファイルリストを見る権限
    * 書き込み(write)権限 : ファイルの内容を書き換える、またはディレクトリ中のファイル操作を行える権限
    * 実行(execute)権限 : ファイル(に書かれたプログラム)の実行、またはディレクトリ中のファイルへのアクセスに対する権限
* この3種類の権限の設定は、各対象ごとに3文字セットで表されます
    * `rwx`の場合、読み込み、書き込み、実行が全て許可されている
    * `--x`の場合、実行のみ許可されている
    * `r--`の場合、読み込みのみ許可されている
    * 順番は常に`r(read), w(write), x(execute)`の順

パーミッションの設定
----

* `~/kenshu/test1`で、`chmod 444 renshu1.txt`と入力してください
    * `renshu1.txt`を編集して保存してみてください

```
macmini-ssuzuki:test1 ssuzuki$ ls -l
total 8
-rw-r--r--@ 1 ssuzuki  staff  495  3 22 21:54 renshu1.txt
drwxr-xr-x  2 ssuzuki  staff   68  3 26 20:00 test11
macmini-ssuzuki:test1 ssuzuki$
macmini-ssuzuki:test1 ssuzuki$ chmod 444 renshu1.txt
macmini-ssuzuki:test1 ssuzuki$ ls -l
total 8
-r--r--r--@ 1 ssuzuki  staff  495  3 22 21:54 renshu1.txt
drwxr-xr-x  2 ssuzuki  staff   68  3 26 20:00 test11
macmini-ssuzuki:test1 ssuzuki$
```

* 保存できませんでしたよね？
    * 書き込み権限がなくなったため、読むことしかできなくなりました
* `chmod`は、ファイルやディレクトリのパーミッションを変更するコマンドです
    * change modeの略
    * 所有者以外は変更することはできません
* `444`って何？
    * 所有者(1桁目)、グループ(2桁目)、その他(3桁目)の権限を表現したものです
    * 以下のルールで数字が決まります

```
| 数字  | 表記 | 数字(2進数)  |
|------|------|-------------|
|   0  |  --- |     000     |
|   1  |  --x |     001     |
|   2  |  -w- |     010     |
|   3  |  -wx |     011     |
|   4  |  r-- |     100     |
|   5  |  r-x |     101     |
|   6  |  rw- |     110     |
|   7  |  rwx |     111     |
```

* つまり、`444`は`-r--r--r--`にする(所有者もグループもその他も読み込みのみ許可)という意味
    * 2進数のビットと対応していることに注目！
* 元の状態`-rw-r--r--`に戻すには……？

なぜ権限を設定するのか
----

* 他のユーザに勝手に見られたくないものを隠すため
    * 複数のユーザが使うシステムなので勝手に触られないようにする
* 誤動作や悪意あるプログラムによってシステムが壊れることを防ぐ
    * 壊れるならまだしも、乗っ取られることも……
    * 権限を設定することで、外部から勝手にシステムをいじられないようにする
